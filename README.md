# HTR Polygon Annotation Tool

–õ–µ–≥–∫–æ–≤–µ—Å–Ω–æ–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∏ —Ä–∞–∑–º–µ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ä—É–∫–æ–ø–∏—Å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ (HTR/OCR). 
–ü–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏: –æ—Ç –∫–∞–¥—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å—Ö–æ–¥–Ω—ã—Ö —Å–∫–∞–Ω–æ–≤ –¥–æ —Ç–æ—á–Ω–æ–π —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ —Å—Ç—Ä–æ–∫ –ø–æ–ª–∏–≥–æ–Ω–∞–º–∏.

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üõ† –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (Cropper)
*   **–ö–∞–¥—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ:** –£–¥–æ–±–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª–µ–∑–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.
*   **–í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ:** –í—Ä–∞—â–µ–Ω–∏–µ –æ–±–ª–∞—Å—Ç–∏ –æ–±—Ä–µ–∑–∫–∏ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞–∫–ª–æ–Ω–∞ —Ç–µ–∫—Å—Ç–∞.
*   **–ù–µ–¥–µ—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:** –û—Ä–∏–≥–∏–Ω–∞–ª—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –ø–æ–∑–≤–æ–ª—è—è –ø–µ—Ä–µ–¥–µ–ª–∞—Ç—å –æ–±—Ä–µ–∑–∫—É –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç.
*   **–ù–∞–≤–∏–≥–∞—Ü–∏—è:** –ë—ã—Å—Ç—Ä—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.

### ‚úèÔ∏è –†–∞–∑–º–µ—Ç–∫–∞ (Editor)
*   **–°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è:** –†–∏—Å–æ–≤–∞–Ω–∏–µ —Ç–æ—á–Ω—ã—Ö –ø–æ–ª–∏–≥–æ–Ω–æ–≤ –≤–æ–∫—Ä—É–≥ —Å—Ç—Ä–æ–∫ —Ç–µ–∫—Å—Ç–∞.
*   **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ, –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ **–ø–æ—Ç–æ—á–µ—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤–µ—Ä—à–∏–Ω –ø–æ–ª–∏–≥–æ–Ω–∞.
*   **–ò—Å—Ç–æ—Ä–∏—è:** –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ Undo / Redo (`Ctrl+Z`, `Ctrl+Shift+Z`).
*   **–ë—ã—Å—Ç—Ä–æ–¥–µ–π—Å—Ç–≤–∏–µ:** SPA-–Ω–∞–≤–∏–≥–∞—Ü–∏—è (–±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã), –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å–µ–¥–Ω–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ.

### ebox –ò–º–ø–æ—Ä—Ç –∏ –≠–∫—Å–ø–æ—Ä—Ç
*   **eScriptorium —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** –ò–º–ø–æ—Ä—Ç –∏ —ç–∫—Å–ø–æ—Ä—Ç ZIP-–∞—Ä—Ö–∏–≤–æ–≤ –≤ —Ñ–æ—Ä–º–∞—Ç–µ METS + PageXML.
*   **–£–ø—Ä–æ—â–µ–Ω–∏–µ:** –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–ø—Ä–æ—â–µ–Ω–∏—è –ø–æ–ª–∏–≥–æ–Ω–æ–≤ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ (—É–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–∏—Ö —Ç–æ—á–µ–∫).

## üõ† –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫
*   **Backend:** Python 3.10 + Flask.
*   **Image Processing:** Pillow (PIL).
*   **Frontend:** Vanilla JS + **Fabric.js** (Canvas rendering).
*   **Storage:** –õ–æ–∫–∞–ª—å–Ω–∞—è —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ (JSON –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ + –æ—Ä–∏–≥–∏–Ω–∞–ª—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π).

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

1.  **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** Python 3.10+.
2.  **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:**
    ```bash
    pip install flask pillow
    ```
3.  **–ó–∞–ø—É—Å–∫:**
    ```bash
    python app.py
    ```
4.  –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –ø–æ –∞–¥—Ä–µ—Å—É: `http://127.0.0.1:5000`

## ‚å®Ô∏è –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏

### –†–µ–¥–∞–∫—Ç–æ—Ä —Ä–∞–∑–º–µ—Ç–∫–∏ (Editor)
| –ö–ª–∞–≤–∏—à–∞ | –î–µ–π—Å—Ç–≤–∏–µ |
| --- | --- |
| **N** | –†–µ–∂–∏–º —Ä–∏—Å–æ–≤–∞–Ω–∏—è (Draw) |
| **V** | –†–µ–∂–∏–º –≤—ã–¥–µ–ª–µ–Ω–∏—è (Select/Edit) |
| **P** | –†–µ–∂–∏–º –ø—Ä–∞–≤–∫–∏ —Ç–æ—á–µ–∫ (Edit Points) |
| **Del** | –£–¥–∞–ª–∏—Ç—å –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–µ |
| **Esc** | –û—Ç–º–µ–Ω–∞ —Ä–∏—Å–æ–≤–∞–Ω–∏—è / –°–±—Ä–æ—Å –≤—ã–¥–µ–ª–µ–Ω–∏—è |
| **Ctrl + Z** | –û—Ç–º–µ–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ (Undo) |
| **Ctrl + Shift + Z** | –í–µ—Ä–Ω—É—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ (Redo) |
| **Ctrl + A** | –í—ã–¥–µ–ª–∏—Ç—å –≤—Å–µ –ø–æ–ª–∏–≥–æ–Ω—ã |
| **Ctrl + ‚Üê / ‚Üí** | –ü—Ä–µ–¥—ã–¥—É—â–µ–µ / –°–ª–µ–¥—É—é—â–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ |
| **–ü–ö–ú** (–∏–ª–∏ Alt+Drag) | –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Ö–æ–ª—Å—Ç–∞ (Pan) |
| **–ö–æ–ª–µ—Å–æ –º—ã—à–∏** | –ó—É–º (Zoom) |

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –æ–±—Ä–µ–∑–∫–∏ (Cropper)
| –ö–ª–∞–≤–∏—à–∞/–î–µ–π—Å—Ç–≤–∏–µ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
| --- | --- |
| **Shift + Drag** | –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ä–∞–º–∫–∏ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ø—Ä–æ–ø–æ—Ä—Ü–∏–π |
| **–ü–ö–ú + Drag** | –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Ö–æ–ª—Å—Ç–∞ (Pan) |
| **–ö–æ–ª–µ—Å–æ –º—ã—à–∏** | –ó—É–º (Zoom) |

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```text
htr_tool/
‚îú‚îÄ‚îÄ app.py                # Flask –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä (—Ä–æ—É—Ç–∏–Ω–≥ –∏ API endpoints)
‚îú‚îÄ‚îÄ logic.py              # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞: –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç, –∫—Ä–æ–ø, XML –ø–∞—Ä—Å–∏–Ω–≥
‚îú‚îÄ‚îÄ storage.py            # –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π (CRUD)
‚îú‚îÄ‚îÄ data/                 # –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ images/           # –†–∞–±–æ—á–∏–µ (–æ–±—Ä–µ–∑–∞–Ω–Ω—ã–µ) –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ originals/        # –ë—ç–∫–∞–ø—ã –æ—Ä–∏–≥–∏–Ω–∞–ª–æ–≤ (–¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ–±—Ä–µ–∑–∫–∏)
‚îÇ   ‚îî‚îÄ‚îÄ annotations/      # JSON —Ñ–∞–π–ª—ã —Ä–∞–∑–º–µ—Ç–∫–∏
‚îú‚îÄ‚îÄ static/
‚îÇ   ‚îú‚îÄ‚îÄ css/style.css     # –°—Ç–∏–ª–∏
‚îÇ   ‚îî‚îÄ‚îÄ js/
‚îÇ       ‚îú‚îÄ‚îÄ api.js        # API –∫–ª–∏–µ–Ω—Ç
‚îÇ       ‚îú‚îÄ‚îÄ editor.js     # –õ–æ–≥–∏–∫–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ —Ä–∞–∑–º–µ—Ç–∫–∏
‚îÇ       ‚îî‚îÄ‚îÄ dashboard.js  # –õ–æ–≥–∏–∫–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
‚îî‚îÄ‚îÄ templates/            # HTML —à–∞–±–ª–æ–Ω—ã
    ‚îú‚îÄ‚îÄ index.html        # –î–∞—à–±–æ—Ä–¥
    ‚îú‚îÄ‚îÄ editor.html       # –†–µ–¥–∞–∫—Ç–æ—Ä —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏
    ‚îî‚îÄ‚îÄ cropper.html      # –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∫–∞–¥—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
```

## üìÑ –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö
–†–∞–∑–º–µ—Ç–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ø–∞–ø–∫—É `data/annotations/` –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON.  
–ü—Ä–∏ –æ–±—Ä–µ–∑–∫–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–ª–µ `crop_params` –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–∞–º–∫–∏.

```json
{
    "image": "filename.jpg",
    "status": "cropped",
    "crop_params": {
        "x": 100, "y": 100, "w": 500, "h": 800, "angle": 2.5
    },
    "regions": [
        {
            "points": [
                {"x": 100, "y": 100},
                {"x": 200, "y": 100}
            ]
        }
    ]
}
```

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (TODO)

*   **Drift bug:** –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ–±—Ä–µ–∑–∫–µ (re-cropping) —É–∂–µ —Ä–∞–∑–º–µ—á–µ–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª–∏–≥–æ–Ω–æ–≤ –º–æ–≥—É—Ç —Å–º–µ—â–∞—Ç—å—Å—è ("—Å–ø–æ–ª–∑–∞—Ç—å"). –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–∞–ª—å–Ω–µ–π—à–µ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏ –ø–µ—Ä–µ—Å—á–µ—Ç–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –ø—Ä–∏ –≤—Ä–∞—â–µ–Ω–∏–∏.
*   **History bug:** `Ctrl+Z` –∏–Ω–æ–≥–¥–∞ –æ—Ç–º–µ–Ω—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–µ–π—Å—Ç–≤–∏–π —Å—Ä–∞–∑—É –∏–ª–∏ –≤—ã–∑—ã–≤–∞–µ—Ç —Å–º–µ—â–µ–Ω–∏–µ –æ–±–ª–∞—Å—Ç–µ–π –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è.
*   **UI:** –ò–Ω–æ–≥–¥–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∞ –º–æ–∂–µ—Ç –Ω–µ –ø—Ä–æ–≥—Ä—É–∑–∏—Ç—å—Å—è —Å –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–∞ (—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã).
* **–°–ª–æ–∏ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ** - –Ω–µ–ª—å–∑—è –≤—ã–±—Ä–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç –ø–æ–¥ –¥—Ä—É–≥–∏–º —ç–ª–µ–º–µ–Ω—Ç–æ–º, –¥–∞–∂–µ —á–µ—Ä–µ–∑ –¥–≤–æ–π–Ω–æ–π –∫–ª–∏–∫. 
* **–£–±—Ä–∞—Ç—å –º–æ–¥–µ–ª—å –≤ –ø–∞–ø–∫—É —Å –º–æ–¥–µ–ª—è–º–∏**
* **–°–¥–µ–ª–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è –∫–∞–∫ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ, –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏**
* **–ò–Ω–æ–≥–¥–∞ –ø—Ä–∏ –∞–≤—Ç–æ—Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –º–æ–¥–µ–ª—å –Ω–∞—Ö–æ–¥–∏—Ç –º–∞–ª–µ–Ω—å–∫–∏–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç –ø–æ–¥ –±–æ–ª—å—à–∏–º** - –Ω—É–∂–Ω–æ –ª–∏–±–æ —Å—Ç—Ä–æ–∏—Ç—å –∫–æ—Å—Ç—ã–ª–∏, –ª–∏–±–æ –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å —Å–∫–æ—Ä–µ–µ —Ü–∏–∫–ª –¥–æ–æ–±—É—á–µ–Ω–∏—è. 